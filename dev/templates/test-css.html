<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Css Test</title>
    <link rel="stylesheet" href="{{STATIC_URL}}css/ui-lightness/jquery-ui-1.8.18.custom.css">
    <link rel="stylesheet" href="{{STATIC_URL}}css/dev/dev.css">
    <link type="image/x-icon" href="{{STATIC_URL}}favicon.ico" rel="shortcut icon">
    <script src="{{STATIC_URL}}js/jquery-1.7.1.min.js"></script>
    <script src="{{STATIC_URL}}js/jquery-ui-1.8.18.custom.min.js"></script>
    <script>
        var hk = ''; // for debug
        $(function(){
            $( '.card_drop' ).droppable({
                greedy:true,
                tolerance:"intersect",
                drop:function(event, ui){
                    //console.log('hands:' + $(this).attr('id').toUpperCase() + ' drop a card');
                    var $draged_card = ui.draggable;
                    var $this_card_drop = $(this);

                    // TODO understand return meanings.
                    // TODO add revert and accept
                    //empty card drop
                    if ( ! $this_card_drop.children().is('.card') ){
                        console.log("move into empty card drop.");
                        $draged_card.appendTo($this_card_drop)
                            .addClass('onhands').removeClass('ondesk')
                            .css('left','0px').css('top','0px');
                    }
                    //not empty card drop and from outside desk and there's free card drop
                    else if ($dragged_card.hasClass('ondesk') && $('li.card_drop > span.ondesk').length>0){
                        console.log("not empty card drop and from outside desk and there's free card drop");
                        var $next_free_drop = $('ul.hands > li:empty:first');
                        $draged_card.appendTo($next_free_drop).css('left','0px').css('top','0px');
                    }
                    //not empty card drop and from outside desk and there's no free card drop
                    else if ($dragged_card.hasClass('ondesk') && $('li.card_drop > span.ondesk').length==0){
                        console.log("not empty card drop and from outside desk and there's no free card drop");
                        //TODO
                    }
                    //not empty card drop and from own self one!
                    else if ( $this_card_drop.attr('id') == $draged_card.parent().attr('id') ) {
                        console.log('this is the self card drop');
                    }
                    //not empty card drop and not self one!
                    else if (true) {
                        console.log('exchange two cards');
                        var $origin_card = $this_card_drop.children();
                        var $before_card_drop = $draged_card.parent();

                        $origin_card.appendTo($before_card_drop).css('left','0px').css('top','0px');
                        $draged_card.appendTo($this_card_drop).css('left','0px').css('top','0px');
                    }
                },
                over:function(event, ui){
                    //console.log('a card is over on hands: ' + $(this).attr('id').toUpperCase());
                },
                out:function(event, ui){
                    //console.log('a card is out of hands: ' + $(this).attr('id').toUpperCase());
                },
            });

            $( '.card_desk' ).droppable({
                greedy:true,
                tolerance:"fit",
                drop:function(event, ui){
                    console.log("desk drop sth.");
                    $dragged_card = ui.draggable;
                    $dragged_card.addClass('ondesk').removeClass('onhands');
                },
                out:function(event, ui){
                },
                over:function(event, ui){
                },
            });

            $( '.card' ).draggable({
                start:function(event, ui){
                    //console.log('a card: ' + $(this).html().toUpperCase() + ' starts to drag');
                },
                stop:function(event, ui){
                    //console.log('a card: ' + $(this).html().toUpperCase() + ' stop drag');
                },
                drag:function(event, ui){
                    //console.log('a card is dragging');
                },
            });

            $('.hands').disableSelection()
        });
	</script>
</head>
<body>
    <ul id="desk" class="card_desk">
        <ul id="hands" class="hands">
            <h3>hands here!</h3>
            <li id="card_1" class="card_drop"><span class="card onhands">some_card1</span></li>
            <li id="card_2" class="card_drop"><span class="card onhands">some_card2</span></li>
            <li id="card_3" class="card_drop"><span class="card onhands">some_card3</span></li>
            <li id="card_4" class="card_drop"><span class="card onhands">some_card4</span></li>
            <li id="card_5" class="card_drop"></li>
            <li id="card_6" class="card_drop"></li>
            <li id="card_7" class="card_drop"></li>
        </ul>
    </ul>
</body>
</html>
